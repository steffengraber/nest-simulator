#!/bin/sh

if [ -n "$VIRTUAL_ENV" ] || [ -n "$CONDA_PREFIX" ]; then
    ENV_PREFIX="${VIRTUAL_ENV:-$CONDA_PREFIX}"
    echo "Running in a virtual environment."
    PACKAGES_PATH=$(python3 -c 'from distutils.sysconfig import get_python_lib; print(get_python_lib())')
    if [ -x "$(find "${PACKAGES_PATH}/bin" -name 'nest' -type f 2>/dev/null)" ]; then
        echo "The binary 'nest' is installed in site-packages/bin. It is a pip installed NEST!"
        ACTIVATE_LINES="export PYTHONPATH=${PACKAGES_PATH}${PYTHONPATH:+:$PYTHONPATH}\nexport PATH=${PACKAGES_PATH}/bin:\${PATH}"
        echo -e "$ACTIVATE_LINES" >> "${ENV_PREFIX}/bin/activate"
        # Execute the exports in ACTIVATE_LINES
        eval "$ACTIVATE_LINES"
        echo "NEST environment setup will now activate/deactivate with the virtual environment."
    fi
else
    # Make PyNEST available by prepending its path to PYTHONPATH in a safe way.
    export PYTHONPATH="@CMAKE_INSTALL_PREFIX@/@PYEXECDIR@${PYTHONPATH:+:$PYTHONPATH}"

    # Make NEST executables available by prepending their path to PATH.
    export PATH="@CMAKE_INSTALL_PREFIX@/@CMAKE_INSTALL_BINDIR@:${PATH}"
fi

